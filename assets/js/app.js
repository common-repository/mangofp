(function(e){function t(t){for(var s,r,o=t[0],l=t[1],c=t[2],u=0,m=[];u<o.length;u++)r=o[u],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&m.push(n[r][0]),n[r]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);d&&d(t);while(m.length)m.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],s=!0,o=1;o<a.length;o++){var l=a[o];0!==n[l]&&(s=!1)}s&&(i.splice(t--,1),e=r(r.s=a[0]))}return e}var s={},n={app:0},i=[];function r(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=s,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(a,s,function(t){return e[t]}.bind(null,s));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var d=l;i.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"111c":function(e,t,a){"use strict";a("b660")},"15ae":function(e,t,a){},1763:function(e,t,a){"use strict";a("ae84")},"24ef":function(e,t,a){"use strict";a("5071")},"2d12":function(e,t,a){},"4e58":function(e,t,a){"use strict";a("81b1")},5071:function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t),a.d(t,"bus",(function(){return kt})),a.d(t,"dataStore",(function(){return It}));a("e260"),a("e6cf"),a("cca6"),a("a79d");var s=a("2b0e"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("MangoFpContainer")],1)},i=[],r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"messages-container"},[e.loaded?a("v-sheet",{staticClass:"pa-md-0"},[a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{attrs:{cols:"12",id:"messages-heading"}},[a("h1",{},[e._v(e._s(e.$locStr("MangoFP messages")))])]),a("v-col",{attrs:{md:"6","d-none":"","d-md-block":""}}),a("v-col",{staticClass:"pa-1",attrs:{cols:"12",md:"6"}},[a("v-select",{staticClass:"generalLabelFilter ma-1",attrs:{items:e.labels,label:"Filter labels",dense:"",multiple:"",outlined:""},scopedSlots:e._u([{key:"prepend-item",fn:function(){return[a("v-list-item",{attrs:{ripple:""},on:{click:e.selectAll}},[a("v-list-item-action",[a("v-icon",{attrs:{color:0==e.labelFilter.length?"primary":""}},[e._v(" "+e._s(e.icon)+" ")])],1),a("v-list-item-content",[a("v-list-item-title",[e._v(" "+e._s(e.$locStr("No filter"))+" ")])],1)],1),a("v-divider",{staticClass:"mt-2"})]},proxy:!0}],null,!1,3527082470),model:{value:e.labelFilter,callback:function(t){e.labelFilter=t},expression:"labelFilter"}})],1)],1),a("v-tabs",{on:{change:e.tabChanged}},[e._l(e.statuses,(function(t){return a("v-tab",{key:t.order},[a("div",{class:e.getTabClasses(t)},[e._v(e._s(t.state))])])})),e._l(e.statuses,(function(t){return a("v-tab-item",{key:t.code},[a("v-row",{attrs:{align:"stretch"}},[a("v-col",{attrs:{cols:e.listWidth,lg:e.listWidth<12?e.listWidth+2:0}},[a("MangoFpListPane",{attrs:{value:"0",submitted:e.filtered,selectedItem:e.selectedItem,labelsData:e.labelsData,showDetails:!e.detailPaneIsOpen},on:{"row-selected":e.rowSelected}})],1),e.selectedItem?a("v-col",{staticClass:"detailPaneContainer",attrs:{cols:"9",lg:"7"}},[a("MangoFpDetailPane",{attrs:{selectedItem:e.selectedItem,submitted:e.submitted,labelsData:e.labelsData,selectedTab:e.selectedTab,statuses:e.statuses},on:{CloseDetails:e.closeSidePane}})],1):e._e()],1)],1)}))],2)],1):a("v-sheet",{staticClass:"pa-md-4"},[a("p",[e._v("Loading ...")])]),a("div",{staticClass:"version-in-footer"},[e._v("Version: "+e._s(e.appVersion))])],1)},o=[],l=(a("4de4"),a("c740"),a("4160"),a("caad"),a("a15b"),a("d81d"),a("a434"),a("b0c0"),a("4fad"),a("d3b7"),a("07ac"),a("2532"),a("3ca3"),a("159b"),a("ddb0"),a("5530")),c=a("3835"),d=(a("96cf"),a("1da1")),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-sheet",[a("v-data-table",{attrs:{headers:e.headers,items:e.submitted,"hide-default-footer":!0,"disable-pagination":!0,dense:""},scopedSlots:e._u([{key:"body",fn:function(t){return[a("tbody",e._l(t.items,(function(t){return a("tr",{key:t.id,class:{selectedLine:e.selectedItem===t.id},on:{click:function(a){return e.selectItem(t)}}},[a("td",{class:e.getUnreadClass(t)},[e._v(e._s(t.label))]),a("td",{class:e.getUnreadClass(t)},[e._v(" "+e._s(t.email)+" ")]),a("td",{class:e.getUnreadClass(t)},[e._v(e._s(t.name))]),a("td",[e._v(e._s(t.note.substr(0,100)))]),a("td",{class:e.getUnreadClass(t)},[e._v(" "+e._s(e.getFormattedDate(t.lastUpdated))+" ")]),e.showDetails?a("td",[a("MangoFpMessageInList",{attrs:{content:t.content}})],1):e._e(),a("td")])})),0)]}}])})],1)},m=[],h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",e._l(e.content,(function(t){return a("div",{key:t.key},[a("strong",[e._v(e._s(t[0])+":")]),e._v(" "+e._s(t[1])+" ")])})),0)},p=[],f={name:"MangoFpMessageInList",props:{content:{type:Array,required:!0}}},v=f,b=a("2877"),g=Object(b["a"])(v,h,p,!1,null,null,null),C=g.exports,S=(a("ac1f"),a("5319"),a("b9b9")),E=a.n(S);function y(e){var t=new Date(2021,11,30),a=t.toLocaleDateString();a=a.replace("30","dd"),a=a.replace("12","mm"),a=a.replace("2021","yyyy");var s=new Date(e.replace(/-/g,"/"));return E()(s,a)}var w={name:"MangoFpListPane",components:{MangoFpMessageInList:C},methods:{selectItem:function(e){this.$emit("row-selected",e)},getFormattedDate:function(e){return y(e)},getUnreadClass:function(e){return e.isUnread?"unRead":""}},props:{selectedItem:{type:String,required:!1},submitted:{type:Array,required:!0},showDetails:{type:Boolean,required:!1}},data:function(){return{search:""}},computed:{headers:function(){var e=[{text:this.$locStr("Label"),align:"left",value:"label",width:"20%"},{text:this.$locStr("Email"),align:"left",value:"email",width:"10%"},{text:this.$locStr("Name"),align:"left",value:"name",width:"10%"},{text:this.$locStr("Note"),align:"left",value:"note",width:"10%"},{text:this.$locStr("Updated"),align:"left",value:"lastUpdated",width:"10%"}];return this.showDetails&&e.push({text:"Sisu",align:"left",value:"content",width:"40%"}),e.push({text:"",align:"left",value:""}),e}}},x=w,_=(a("67ae"),a("6544")),A=a.n(_),j=a("8fea"),O=a("8dd9"),T=Object(b["a"])(x,u,m,!1,null,null,null),k=T.exports;A()(T,{VDataTable:j["a"],VSheet:O["a"]});var I=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-row",{staticClass:"detailPane"},[a("div",{staticClass:"ml-auto pt-2 pr-2 mb-n1"},[a("v-btn",{staticClass:"small-action-button",attrs:{"x-small":"",color:"gray",icon:""},on:{click:e.closeDetailsPane}},[a("v-icon",[e._v("mdi-close")])],1)],1),a("v-col",{staticClass:"pa-2",attrs:{cols:"12"}},[a("v-expansion-panels",{attrs:{multiple:""},model:{value:e.dataOpen,callback:function(t){e.dataOpen=t},expression:"dataOpen"}},[a("v-expansion-panel",[a("v-expansion-panel-header",{staticClass:"pb-1",scopedSlots:e._u([{key:"default",fn:function(t){var s=t.open;return[a("div",s?[a("v-row",{attrs:{"no-gutters":""}},[a("div",{staticClass:"actionHeader"},[a("div",[e._v(" "+e._s(e.$locStr("Change Contact Data"))+" ")])])])]:[a("v-row",{staticClass:"d-flex"},[a("div",{staticClass:"mr-2 pl-2 actionHeader"},[e._v(" "+e._s(e.$locStr("Contact data for"))+": ")]),a("div",[e._v(" "+e._s(e.getContactDataSummary())+" ")])]),a("div",{staticClass:"pt-3 content-on-detail-header"},[a("MangoFpMessageInList",{attrs:{content:e.details.content}})],1),a("v-row",[a("v-col",{staticClass:"notePreview pl-2",attrs:{cols:"12"}},[e._v(" "+e._s(e.details.note)+" ")])],1)],1)]}}])}),a("v-expansion-panel-content",[e.selectedItem?a("v-sheet",[a("div",{staticClass:"d-flex flex-row email-details-on-cd"},[a("div",{staticClass:"labelText align-self-center mr-2"},[e._v(" "+e._s(e.$locStr("Label"))+" ")]),a("v-select",{staticClass:"mb-0 pb-1",attrs:{items:e.labels},model:{value:e.selectedLabel,callback:function(t){e.selectedLabel=t},expression:"selectedLabel"}})],1),a("v-row",{staticClass:"email-details-on-cd",attrs:{"no-gutters":""}},[a("v-col",{staticClass:"d-flex flex-row",attrs:{cols:"6"}},[a("div",{staticClass:"labelText align-self-center mr-2 pb-4"},[e._v(" "+e._s(e.$locStr("Name"))+" ")]),a("v-text-field",{staticClass:"detailField pt-0",on:{change:e.nameChanged},model:{value:e.details.name,callback:function(t){e.$set(e.details,"name",t)},expression:"details.name"}})],1),a("v-col",{staticClass:"d-flex flex-row",attrs:{cols:"6"}},[a("div",{staticClass:"labelText align-self-center ml-2 mr-2 pb-4"},[e._v(" "+e._s(e.$locStr("Email"))+" ")]),a("v-text-field",{staticClass:"detailField pt-0",on:{change:e.emailChanged},model:{value:e.details.email,callback:function(t){e.$set(e.details,"email",t)},expression:"details.email"}})],1)],1),a("v-textarea",{staticClass:"detailField pt-0",attrs:{flat:"",rows:e.rowsForNote,label:e.$locStr("Note")},on:{change:e.noteChanged},model:{value:e.details.note,callback:function(t){e.$set(e.details,"note",t)},expression:"details.note"}}),a("v-expansion-panels",{attrs:{multiple:"",tile:""},model:{value:e.contentOpen,callback:function(t){e.contentOpen=t},expression:"contentOpen"}},[a("v-expansion-panel",[a("v-expansion-panel-header",[e._v(" "+e._s(e.$locStr("Additional content"))+" ")]),a("v-expansion-panel-content",[a("MangoFpMessageInList",{staticClass:"contentInDetail",attrs:{content:e.details.content}})],1)],1)],1)],1):e._e()],1)],1)],1)],1),a("v-col",{attrs:{cols:"12"}},[a("v-card",[e.globalState.templateLoaded?a("v-tabs",{model:{value:e.selectedDetail,callback:function(t){e.selectedDetail=t},expression:"selectedDetail"}},[a("v-tab",[a("v-icon",{attrs:{left:""}},[e._v("mdi-history")]),e._v(" "+e._s(e.$locStr("Action"))+" ")],1),a("v-tab",[a("v-icon",{attrs:{left:""}},[e._v("mdi-email-outline")]),e._v(" "+e._s(e.$locStr("Messages"))+" ")],1),a("v-tab-item",{attrs:{transition:"fade-transition","reverse-transition":"false"}},[a("MangoFpStateSelector",{attrs:{selectedTab:e.selectedTab,statuses:e.statuses,contactDetails:e.details,emailTemplates:e.emailTemplates,details:e.details}})],1),a("v-tab-item",{attrs:{transition:"fade-transition","reverse-transition":"false"}},[a("MangoFpEmail",{attrs:{selectedTab:e.selectedTab,emailTemplates:e.emailTemplates,details:e.details}}),a("MangoFpEmailHistory",{attrs:{messageId:e.selectedItem}})],1)],1):e._e()],1)],1)],1)},F=[],$=(a("7db0"),a("a9e3"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",[a("div",{staticClass:"px-3"},[a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{attrs:{cols:"12",sm:"6"}},[a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{staticClass:"actionHeader pt-2",attrs:{cols:"12",md:"4"}},[e._v(" "+e._s(e.$locStr("Next step"))+" ")]),a("v-col",{staticClass:"pt-0",attrs:{cols:"12",md:"8"}},[a("v-select",{staticClass:"pt-md-0",attrs:{items:e.actions},on:{change:e.actionSelected},model:{value:e.actionObj,callback:function(t){e.actionObj=t},expression:"actionObj"}})],1)],1)],1),a("v-col",{attrs:{cols:"12",sm:"6"}},[a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{staticClass:"actionHeader pt-2 pl-md-6 toRight"},[e._v(" "+e._s(e.$locStr("Email message"))+" ")]),a("v-col",{staticClass:"pt-0 pl-4"},[a("v-switch",{staticClass:"mt-0",attrs:{inset:""},model:{value:e.enableEmail,callback:function(t){e.enableEmail=t},expression:"enableEmail"}})],1)],1)],1)],1)],1),e.enableEmail?a("div",[a("MangoFpEmailForm",{attrs:{emailFormName:"",emailContent:e.emailContent,emailSubject:e.emailSubject,addresses:e.addresses,ccaddresses:e.ccaddresses,contactEmail:e.details.email},on:{sendEmail:e.confirmAndSend},scopedSlots:e._u([{key:"action",fn:function(t){return[a("v-btn",{attrs:{color:"blue darken-1",outlined:"",disabled:t.disabledWhileActionInProgress},nativeOn:{click:function(e){return t.confirmAndSend(e)}}},[e._v(" "+e._s(e.$locStr("Confirm and send"))+" ")])]}}],null,!1,786439523)})],1):e._e(),e.enableEmail?e._e():a("v-btn",{attrs:{outlined:"",color:"blue darken-1"},nativeOn:{click:function(t){return e.confirm(t)}}},[e._v(" "+e._s(e.$locStr("Confirm"))+" ")])],1)}),M=[],P=(a("4d63"),a("25f0"),a("2909")),U=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"mb-5"},[e.emailFormName?a("v-card-title",{staticClass:"pb-0"},[a("div",{staticClass:"d-inline-block"},[e._v(" "+e._s(e.emailFormName)+" ")]),a("div",{staticClass:"d-inline-block ml-auto"},[a("v-btn",{staticClass:"small-action-button",attrs:{"x-small":"",color:"gray",icon:""},on:{click:e.cancel}},[a("v-icon",[e._v("mdi-close")])],1)],1)]):e._e(),a("v-card-text",{staticClass:"pt-0 pb-0"},[a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{staticClass:"pb-0 pt-0",attrs:{cols:"12",md:"7"}},[a("div",{staticClass:"d-flex flex-row"},[a("div",{staticClass:"labelText align-self-center mr-2"},[e._v(" "+e._s(e.$locStr("To"))+" ")]),a("v-text-field",{staticClass:"detailField pt-0",attrs:{hint:e.$locStr("Email address or addresses separated with ;"),error:!!e.addressesError,"error-messages":e.addressesError},on:{blur:e.validateAddresses,focus:e.clearAddressErrors},model:{value:e.address4Edit,callback:function(t){e.address4Edit=t},expression:"address4Edit"}})],1)]),a("v-col",{staticClass:"pb-0 pt-0",attrs:{cols:"12",md:"5"}},[a("div",{staticClass:"d-flex flex-row"},[a("div",{staticClass:"labelText align-self-center mr-2 pl-md-2"},[e._v(" "+e._s(e.$locStr("CC"))+" ")]),a("v-text-field",{staticClass:"detailField pt-0",attrs:{hint:e.$locStr("Email CC address(es)"),error:!!e.ccAddressError,"error-messages":e.ccAddressError},on:{blur:e.validateCCAddresses,focus:e.clearCCAddressesErrors},model:{value:e.ccAddress4Edit,callback:function(t){e.ccAddress4Edit=t},expression:"ccAddress4Edit"}})],1)])],1),a("div",{staticClass:"d-flex flex-row mt-md-n3"},[a("div",{staticClass:"labelText align-self-center mr-2"},[e._v(" "+e._s(e.$locStr("Subject"))+" ")]),a("v-text-field",{staticClass:"detailField pt-0",model:{value:e.emailSubject4Edit,callback:function(t){e.emailSubject4Edit=t},expression:"emailSubject4Edit"}})],1)],1),a("v-card-text",{staticClass:"pb-0 pt-0"},[a("vue-editor",{staticClass:"emailEditor",attrs:{editorToolbar:e.editorToolbar},model:{value:e.emailContent4Edit,callback:function(t){e.emailContent4Edit=t},expression:"emailContent4Edit"}})],1),a("v-card-actions",{staticClass:"pt-0 pl-5"},[e._t("action",[a("v-btn",{attrs:{color:"blue darken-1",outlined:"",disabled:e.disabledWhileActionInProgress},nativeOn:{click:function(t){return e.confirmAndSend(t)}}},[e._v(" "+e._s(e.$locStr("Send"))+" ")])],{confirmAndSend:e.confirmAndSend,disabledWhileActionInProgress:e.disabledWhileActionInProgress}),a("MangoFpAttachment",{on:{attachmentsReceived:e.addAttachments,submittingAttachments:e.submittingAttachments,submittingAttachmentsFinished:e.submittingAttachmentsFinished}})],2),e._l(e.attachments,(function(t){return a("v-chip",{key:t.id,staticClass:"ma-2",attrs:{color:"primary",label:"",close:""},on:{"click:close":function(a){return e.removeAttachment(t.id)},click:function(a){return e.downloadAttachment(t.url)}}},[e._v(" "+e._s(t.file_name)+" ")])}))],2)},V=[],R=(a("99af"),a("1276"),a("498a"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container pt-2"},[a("div",{staticClass:"large-12 medium-12 small-12 cell"},[a("input",{ref:"files",attrs:{if:"",type:"file",id:"file",multiple:""},on:{change:function(t){return e.handleFileUpload()}}}),e.uploadPercentage?a("v-progress-circular",{attrs:{rotate:-90,size:40,width:5,value:e.uploadPercentage,color:"primary"}},[e._v(" "+e._s(e.uploadPercentage)+" ")]):a("v-icon",{attrs:{large:"",color:"blue darken-2"},on:{click:e.attachFile}},[e._v(" mdi-paperclip ")])],1)])}),D=[],N=a("bc3a"),L=a.n(N),H={data:function(){return{uploadPercentage:0}},methods:{attachFile:function(){this.$refs.files.click()},handleFileUpload:function(){this.files=this.$refs.files.files,this.submitFile()},submitFile:function(){var e=this,t=new FormData;this.$emit("submittingAttachments");for(var a=0;a<this.files.length;a++){var s=this.files[a];t.append("files["+a+"]",s)}this.uploadPercentage=2;var n=function(t){e.uploadPercentage=parseInt(Math.round(t.loaded/t.total*100)-1)};L.a.post(MANGOFP_RESOURCES["adminUrl"]+"/attachments",t,{headers:{"Content-Type":"multipart/form-data","X-WP-Nonce":MANGOFP_RESOURCES["nonce"]},onUploadProgress:n}).then((function(t){return e.uploadPercentage=0,e.$emit("attachmentsReceived",t.data.payload),!0})).catch((function(t){kt.$emit("ErrorConnection",{error:t.message||"Uploading attachments failed"}),e.uploadPercentage=0,e.$emit("submittingAttachmentsFinished")}))}},props:{}},q=H,W=(a("24ef"),a("132d")),G=a("490a"),B=Object(b["a"])(q,R,D,!1,null,"6f0b1b35",null),J=B.exports;A()(B,{VIcon:W["a"],VProgressCircular:G["a"]});var z=a("5873"),X={name:"MangoFpEmailForm",components:{MangoFpAttachment:J,VueEditor:z["a"]},data:function(){return{attachments:[],disabledWhileActionInProgress:!1,address4Edit:this.getEmailsAsString(this.addresses),ccAddress4Edit:this.getEmailsAsString(this.ccaddresses),emailContent4Edit:this.emailContent,emailSubject4Edit:this.emailSubject,addressesError:"",ccAddressError:"",editorToolbar:[[{header:[!1,1,2,3,4,5,6]}],["bold","italic","underline","strike"],[{align:""},{align:"center"},{align:"right"},{align:"justify"}],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{indent:"-1"},{indent:"+1"}],[{color:[]},{background:[]}],["link"],["clean"]]}},mounted:function(){this.setFocusToEmailText()},methods:{getEmailsAsString:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=t.map((function(t){return"[contactEmail]"==t?e.contactEmail:t}));return a.join("; ")},validateAddresses:function(){try{var e=this.validateAndGetEmailAddresses(this.address4Edit);return this.clearAddressErrors(),e}catch(t){return this.addressesError=t.message||"Error validating messages",!1}},validateCCAddresses:function(){try{var e=this.validateAndGetEmailAddresses(this.ccAddress4Edit);return this.clearCCAddressesErrors(),e}catch(t){return this.ccAddressError=t.message||"Error validating messages",!1}},clearAddressErrors:function(){this.addressesError=""},clearCCAddressesErrors:function(){this.ccAddressError=""},clearErrors:function(){this.clearAddressErrors(),this.clearCCAddressesErrors()},confirmAndSend:function(){this.dialog=!1;var e=this.address4Edit,t=this.ccAddress4Edit;return this.clearErrors(),this.address4Edit.trim()?(e=this.validateAddresses(),!!e&&(t=this.validateCCAddresses(),!1!==t&&void this.$emit("sendEmail",{emailContent:this.emailContent4Edit,emailSubject:this.emailSubject4Edit,addresses:e,ccAddresses:t,emailAttachments:this.attachments.map((function(e){return e.id}))}))):(this.addressesError=this.$locStr("Please input email address"),!1)},cancel:function(){this.$emit("cancelEmail")},addAttachments:function(e){this.attachments=[].concat(Object(P["a"])(this.attachments),Object(P["a"])(e)),this.disabledWhileActionInProgress=!1},submittingAttachments:function(){this.disabledWhileActionInProgress=!0},submittingAttachmentsFinished:function(){this.disabledWhileActionInProgress=!1},removeAttachment:function(e){this.attachments=this.attachments.filter((function(t){return t.id!==e}))},downloadAttachment:function(e){var t=document.createElement("a");t.href=e,t.download=e.split("/").pop(),document.body.appendChild(t),t.click(),document.body.removeChild(t)},validateAndGetEmailAddresses:function(e){var t=this;if(!e)return[];var a=e.split(";").map((function(e){return e.trim()})),s=a.map((function(e){var a=e.trim();if(!a)return"";var s=/([a-zA-Z0-9+._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/;if(!s.test(a))throw new Error(t.$locStr("Email format is not correct"));return a}));return s.filter((function(e){return e}))},setFocusToEmailText:function(){}},props:{emailFormName:{type:String,required:!0},emailContent:{type:String,required:!0},emailSubject:{type:String,required:!0},addresses:{type:Array,required:!0},ccaddresses:{type:Array,required:!0},contactEmail:{type:String,required:!1}},watch:{addresses:function(e){this.clearErrors(),this.address4Edit=this.getEmailsAsString(e)},ccaddresses:function(e){this.clearErrors(),this.ccAddress4Edit=this.getEmailsAsString(e)},contactEmail:function(){this.clearErrors(),this.setFocusToEmailText(),this.address4Edit=this.getEmailsAsString(this.addresses),this.ccAddress4Edit=this.getEmailsAsString(this.ccaddresses)},emailContent:function(e){this.emailContent4Edit=e},emailSubject:function(e){this.emailSubject4Edit=e}}},Z=X,K=(a("6b1b"),a("8336")),Q=a("b0af"),Y=a("99d9"),ee=a("cc20"),te=a("62ad"),ae=a("0fd9"),se=a("8654"),ne=Object(b["a"])(Z,U,V,!1,null,null,null),ie=ne.exports;A()(ne,{VBtn:K["a"],VCard:Q["a"],VCardActions:Y["a"],VCardText:Y["b"],VCardTitle:Y["c"],VChip:ee["a"],VCol:te["a"],VIcon:W["a"],VRow:ae["a"],VTextField:se["a"]});var re={name:"MangoFpStateSelector",components:{MangoFpEmailForm:ie},data:function(){return{emailContent:"",emailSubject:"",addresses:[],ccaddresses:[],actionName:"",actionObj:{value:"",text:""},attachments:[],disabledWhileActionInProgress:!1,enableEmail:!1}},methods:{clear:function(){this.emailContent="",this.addresses=["[contactEmail]"],this.ccaddresses=[],this.actionName="",this.emailSubject="",this.actionObj={value:"",text:""}},actionSelected:function(e){var t=this,a=["name","label","email","note"],s="";e in this.emailTemplates&&(s=this.emailTemplates[e].template,this.ccaddresses=Object(P["a"])(this.emailTemplates[e].ccAddresses),this.addresses=Object(P["a"])(this.emailTemplates[e].addresses)),a.forEach((function(e){s=s.replace(new RegExp("<<"+e+">>","g"),t.details[e])})),this.emailContent=s,this.enableEmail=!!s,this.emailSubject=this.details.label;var n=this.actions.find((function(t){return t.value===e}));this.actionName=n.text,this.actionObj=n},confirmAndSend:function(e){kt.$emit("EventSendEmailAndChangeState",{messageId:this.details.id,newState:this.actionObj.value,emailContent:e.emailContent,emailSubject:e.emailSubject,addresses:e.addresses,ccAddresses:e.ccAddresses,emailAttachments:e.emailAttachments})},confirm:function(){this.dialog=!1,kt.$emit("EventMessageStateChanged",{messageId:this.details.id,newState:this.actionObj.value})}},computed:{actions:function(){if(this.selectedTab&&this.statuses[this.selectedTab]&&this.statuses[this.selectedTab].next&&!Array.isArray(this.statuses[this.selectedTab].next))return[];var e={};return Object.values(this.statuses).forEach((function(t){e[t.code]=t.action})),this.statuses[this.selectedTab].next.map((function(t){return{value:t,text:e[t]}}))}},props:{selectedTab:{type:Number,required:!0},statuses:{type:Array,required:!0},emailTemplates:{type:Object,required:!1},details:{type:Object,required:!0}},created:function(){this.actionSelected(this.actions[0].value)},watch:{details:function(e){e&&this.actionSelected(this.actions[0].value)}}},oe=re,le=(a("1763"),a("a523")),ce=a("b974"),de=a("b73d"),ue=Object(b["a"])(oe,$,M,!1,null,null,null),me=ue.exports;A()(ue,{VBtn:K["a"],VCol:te["a"],VContainer:le["a"],VRow:ae["a"],VSelect:ce["a"],VSwitch:de["a"]});var he=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-expansion-panels",{model:{value:e.expanded,callback:function(t){e.expanded=t},expression:"expanded"}},e._l(e.emailHistory,(function(t){return a("v-expansion-panel",{key:t.id,ref:"panel"+t.id,refInFor:!0},[a("v-expansion-panel-header",{staticClass:"pb-0",on:{click:function(a){return e.clickOnPanelHeader(t)}},scopedSlots:e._u([{key:"default",fn:function(s){var n=s.open;return[a("div",[a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{class:t.headerClasses,attrs:{cols:"3"}},[e._v(" "+e._s(e.getFormattedDate(t.dateTime))+" ")]),a("v-col",{attrs:{cols:"3"}},[a("v-chip",{staticClass:"mt-n1",attrs:{small:"",color:e.getItemType(t).color,outlined:""}},[a("v-icon",{attrs:{left:""}},[e._v(" "+e._s(e.getItemType(t).icon)+" ")]),e._v(" "+e._s(e.getItemType(t).name)+" ")],1)],1),n?a("v-col",{attrs:{cols:"6"}},[a("div",{staticClass:"ml-auto"},[a("div",{staticClass:"text-right"},[a("v-menu",{attrs:{top:"","close-on-click":!0},scopedSlots:e._u([{key:"activator",fn:function(t){var s=t.on,n=t.attrs;return[a("v-btn",e._g(e._b({staticClass:"mr-2 historyItemMenu",attrs:{fab:"",outlined:"","x-small":"",color:"primary"}},"v-btn",n,!1),s),[a("v-icon",{attrs:{dark:""}},[e._v(" mdi-minus ")])],1)]}}],null,!0)},[a("v-list",e._l(e.menuItems,(function(s,n){return a("v-list-item",{key:n,staticClass:"historyItemMenuRow"},[a("v-list-item-title",{on:{click:function(e){return s.action(t)}}},[e._v(e._s(s.title))])],1)})),1)],1)],1)])]):a("v-col",{staticClass:"emailExplanationHeader",attrs:{cols:"6"}},[a("div",{class:t.headerClasses},[e._v(" "+e._s(e.getExplanation(t))+" ")])])],1),a("v-row",[n?e._e():a("v-col",{staticClass:"emailContentPreview",attrs:{cols:"12"}},[e._v(" "+e._s(e.getContentPreview(t.contentMessage))+" ")])],1)],1)]}}],null,!0)}),a("v-expansion-panel-content",[t.contentFrom?a("div",{staticClass:"d-flex flex-row"},[a("div",{staticClass:"emailContentHeaderLabel"},[e._v(" "+e._s(e.$locStr("From"))+": ")]),a("div",{staticClass:"emailContentHeader"},[e._v(" "+e._s(t.contentFrom)+": ")])]):e._e(),t.contentTo?a("div",{staticClass:"d-flex flex-row"},[a("div",{staticClass:"emailContentHeaderLabel"},[e._v(" "+e._s(e.$locStr("To"))+": ")]),a("div",{staticClass:"emailContentHeader"},[e._v(e._s(t.contentTo)+":")])]):e._e(),a("div",{staticClass:"d-flex flex-row"},[a("div",{staticClass:"emailContentHeaderLabel"},[e._v(" "+e._s(e.$locStr("Subject"))+": ")]),a("div",{staticClass:"emailContentHeader"},[e._v(" "+e._s(t.contentSubject)+" ")])]),a("div",{domProps:{innerHTML:e._s(t.contentMessage)}})])],1)})),1)},pe=[],fe=(a("13d5"),MANGOFP_RESOURCES["adminUrl"]),ve=MANGOFP_RESOURCES["nonce"];function be(e){return ge.apply(this,arguments)}function ge(){return ge=Object(d["a"])(regeneratorRuntime.mark((function e(t){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={headers:{"X-WP-Nonce":ve}},e.next=3,L.a.get(fe+t,a);case 3:if(s=e.sent,s&&200===s.status){e.next=6;break}throw new Error("Unable to read data from "+t);case 6:if("status"in s.data&&"RESULT_SUCCESS"===s.data.status&&"payload"in s.data){e.next=8;break}throw new Error("Could not read response status");case 8:return e.abrupt("return",s.data.payload);case 9:case"end":return e.stop()}}),e)}))),ge.apply(this,arguments)}function Ce(e,t){return Se.apply(this,arguments)}function Se(){return Se=Object(d["a"])(regeneratorRuntime.mark((function e(t,a){var s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s={headers:{"X-WP-Nonce":ve}},e.next=3,L.a.post(fe+t,a,s);case 3:if(n=e.sent,n&&200===n.status){e.next=6;break}throw new Error("Error received from request. Details: "+t);case 6:if("status"in n.data&&"RESULT_SUCCESS"===n.data.status&&"payload"in n.data){e.next=8;break}throw new Error("Could not read response status");case 8:return e.abrupt("return",n.data.payload);case 9:case"end":return e.stop()}}),e)}))),Se.apply(this,arguments)}function Ee(){return ye.apply(this,arguments)}function ye(){return ye=Object(d["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,be("/labels");case 2:if(t=e.sent,"labels"in t&&Array.isArray(t.labels)){e.next=5;break}throw new Error("No labels found in response");case 5:return a=[],t.labels.forEach((function(e){a.push({id:e.id,name:e.name})})),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)}))),ye.apply(this,arguments)}function we(e){try{var t=It.getSteps(),a={id:e.id,form:e.form,labelId:e.labelId,code:e.code,state:e.code in t?t[e.code].state:"??",email:e.email,name:e.name,note:e.note,lastUpdated:e.lastUpdated,isUnread:e.isUnread,content:Object.entries(JSON.parse(e.content))};return"changeHistory"in e&&(a.changeHistory=e.changeHistory),a}catch(s){return!1}}function xe(){return _e.apply(this,arguments)}function _e(){return _e=Object(d["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=function(e,t){var a=e.lastUpdated,s=t.lastUpdated;return a<s?1:a>s?-1:0},e.next=3,be("/messages");case 3:if(t=e.sent,"messages"in t&&Array.isArray(t.messages)){e.next=6;break}throw new Error("No messages found in response");case 6:return e.abrupt("return",t.messages.sort(a));case 7:case"end":return e.stop()}}),e)}))),_e.apply(this,arguments)}function Ae(e){for(var t in e.forEach((function(e){var t=we(e);t&&It.addMessage(t)})),It.steps)It.checkAndSetStepUnreadStatus(t);return!0}function je(e,t){return Oe.apply(this,arguments)}function Oe(){return Oe=Object(d["a"])(regeneratorRuntime.mark((function e(t,a){var s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s={id:t.message.id,message:{id:t.message.id},email:{content:t.message.emailContent,addresses:t.message.addresses,ccAddresses:t.message.ccAddresses,subject:t.message.emailSubject||"",attachments:t.message.emailAttachments}},e.next=3,Ce("/messages/"+s.id+"/emails",s).catch((function(e){a.$emit("ErrorConnection",{error:e.message||"Unidentified connection error"})}));case 3:return n=e.sent,n&&a.$emit("DataMessageUpdated",we(n.message)),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)}))),Oe.apply(this,arguments)}function Te(e,t){return ke.apply(this,arguments)}function ke(){return ke=Object(d["a"])(regeneratorRuntime.mark((function e(t,a){var s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s={id:t.message.id,message:{id:t.message.id,code:t.message.code,email:t.message.email,labelId:t.message.labelId,name:t.message.name,note:t.message.note},email:!1},"emailContent"in t.message&&"addresses"in t.message&&(s.email={content:t.message.emailContent,addresses:t.message.addresses,ccAddresses:t.message.ccAddresses||[],subject:t.message.emailSubject||"",attachments:t.message.emailAttachments}),e.next=4,Ce("/messages/"+s.id,s).catch((function(e){a.$emit("ErrorConnection",{error:e.message||"Unidentified connection error"})}));case 4:return n=e.sent,n&&a.$emit("DataMessageUpdated",we(n.message)),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)}))),ke.apply(this,arguments)}function Ie(e,t){return Fe.apply(this,arguments)}function Fe(){return Fe=Object(d["a"])(regeneratorRuntime.mark((function e(t,a){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t||a.emit("ErrorConnection",{error:"no id for get request"}),e.next=3,be("/messages/"+t).catch((function(e){a.$emit("ErrorConnection",{error:e.message||"Unidentified connection error"})}));case 3:return s=e.sent,s&&a.$emit("DataMessageUpdated",we(s.message)),e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)}))),Fe.apply(this,arguments)}function $e(){return Me.apply(this,arguments)}function Me(){return Me=Object(d["a"])(regeneratorRuntime.mark((function e(){var t,a,s,n,i,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,be("/steps");case 2:if(t=e.sent,"steps"in t){e.next=5;break}throw new Error("No steps found in response");case 5:for(It.resetSteps(),a=0,s=Object.entries(t.steps);a<s.length;a++)n=Object(c["a"])(s[a],2),i=n[0],r=n[1],It.setStep(i,r);return e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)}))),Me.apply(this,arguments)}function Pe(){return Ue.apply(this,arguments)}function Ue(){return Ue=Object(d["a"])(regeneratorRuntime.mark((function e(){var t,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,be("/templates");case 2:if(t=e.sent,t&&"templates"in t)for(a in t.templates)s=t.templates[a],s&&"template"in s&&It.setTemplate(a,{addresses:s.mainAddresses,ccAddresses:s.addresses,template:s.template});return It.setTemplatesLoaded(!0),e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)}))),Ue.apply(this,arguments)}function Ve(e){return Re.apply(this,arguments)}function Re(){return Re=Object(d["a"])(regeneratorRuntime.mark((function e(t){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={isUnread:t.isUnread},e.next=3,Ce("/messages/"+t.itemId+"/history/"+t.id,a).catch((function(e){throw new Error("Connection error: "+e.message)}));case 3:if(s=e.sent,!s){e.next=6;break}return e.abrupt("return",It.setMessageHistoryItemRead({messageId:t.itemId,historyItemId:t.id,isUnread:t.isUnread}));case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)}))),Re.apply(this,arguments)}var De={name:"MangoFpEmailHistory",props:{messageId:{type:String,required:!0}},data:function(){return{expanded:void 0,headers:[{text:this.$locStr("Date"),value:"dateTime"},{text:this.$locStr("Status"),value:"changeSubType"},{text:this.$locStr("To"),value:"contentTo"}],messageTypes:{step:{color:"primary",icon:"mdi-label-outline",name:this.$locStr("unknown step")},none:{color:"indigo",icon:"mdi-email-outline",name:this.$locStr("email")},reply:{color:"success",icon:"mdi-reply-outline",name:this.$locStr("reply")},default:{color:"indigo",icon:"mdi-note-text-outline",name:this.$locStr("other action")}},menuItems:[{title:"Mark unread",action:this.markUnread}]}},computed:{history:function(){return It.getMessageHistory(this.messageId)||[]},emailHistory:function(){var e=this;return this.history.reduce((function(t,a){if("EMAIL_SENT"===a.changeType){var s=JSON.parse(a.content);t.push({id:a.id,dateTime:a.create_time,changeType:a.changeType,changeSubType:a.changeSubType,contentTo:s.to,contentFrom:"",contentMessage:s.message,contentSubject:s.subject,isUnread:!!a.isUnread,headerClasses:e.boldWhenNew(a)})}else if("EMAIL_RECEIVED"===a.changeType){var n=JSON.parse(a.content);t.push({id:a.id,dateTime:a.create_time,changeType:a.changeType,changeSubType:"reply",contentTo:"",contentFrom:n.from,contentMessage:n.message,contentSubject:n.subject,isUnread:!!a.isUnread,headerClasses:e.boldWhenNew(a)})}return t}),[])},allSteps:function(){try{return It.getSteps()}catch(e){return{}}}},methods:{getFormattedDate:function(e){return y(e)},getExplanation:function(e){return e.contentSubject||this.$locStr("To")+":"+e.contentTo},getContentPreview:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||""},getItemType:function(e){var t=e.changeSubType||"default";if(t in this.allSteps){var a=this.allSteps[t].state||t;return Object(l["a"])(Object(l["a"])({},this.messageTypes["step"]),{},{name:a})}return t in this.messageTypes?this.messageTypes[t]:this.messageTypes["default"]},boldWhenNew:function(e){return e.isUnread?"unreadItem":""},toggleItemPanel:function(e){var t=this.$refs["panel"+e.id];if(!t)throw new Error("Trying to fetch panel that does not exist");t[0].toggle()},clickOnPanelHeader:function(e){void 0===this.expanded&&e.isUnread&&this.markRead(e)},markRead:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function a(){var s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s=t.history.find((function(t){return t.id==e.id})),s){a.next=3;break}throw new Error("Somehow history item is not found for ".item.id);case 3:Ve(Object(l["a"])(Object(l["a"])({},s),{},{isUnread:!1}));case 4:case"end":return a.stop()}}),a)})))()},markUnread:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function a(){var s,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s=t.history.find((function(t){return t.id==e.id})),s){a.next=3;break}throw new Error("Somehow history item is not found for ".item.id);case 3:return a.next=5,Ve(Object(l["a"])(Object(l["a"])({},s),{},{isUnread:!0}));case 5:n=a.sent,n&&t.toggleItemPanel(e);case 7:case"end":return a.stop()}}),a)})))()}}},Ne=De,Le=(a("6ec9"),a("cd55")),He=a("49e2"),qe=a("c865"),We=a("0393"),Ge=a("8860"),Be=a("da13"),Je=a("5d23"),ze=a("e449"),Xe=Object(b["a"])(Ne,he,pe,!1,null,null,null),Ze=Xe.exports;A()(Xe,{VBtn:K["a"],VChip:ee["a"],VCol:te["a"],VExpansionPanel:Le["a"],VExpansionPanelContent:He["a"],VExpansionPanelHeader:qe["a"],VExpansionPanels:We["a"],VIcon:W["a"],VList:Ge["a"],VListItem:Be["a"],VListItemTitle:Je["b"],VMenu:ze["a"],VRow:ae["a"]});var Ke=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",[a("v-row",{attrs:{"no-gutters":""}},[a("v-col",[a("v-card",[e.composingInProgress?a("MangoFpEmailForm",{attrs:{emailFormName:e.$locStr("Send email"),emailContent:e.emailContent,emailSubject:e.emailSubject,addresses:e.addresses,ccaddresses:e.ccaddresses,contactEmail:e.details.email},on:{sendEmail:e.send,cancelEmail:e.cancelEmail}}):a("div",{staticClass:"pa-5"},[a("v-btn",{attrs:{color:"primary",outlined:""},on:{click:e.createNewEmail}},[e._v(" "+e._s(e.$locStr("New email"))+" ")])],1)],1)],1)],1)],1)},Qe=[],Ye={name:"MangoFpEmail",components:{MangoFpEmailForm:ie},data:function(){return{composingInProgress:!1,emailContent:"",attachments:[],ccaddresses:[],disabledWhileActionInProgress:!1}},computed:{addresses:function(){return[this.details.email]},emailSubject:function(){return this.details.label||""}},methods:{send:function(e){kt.$emit("EventSendEmail",{messageId:this.details.id,emailContent:e.emailContent,emailSubject:e.emailSubject,addresses:e.addresses,ccAddresses:e.ccAddresses,emailAttachments:e.emailAttachments}),this.composingInProgress=!1},createNewEmail:function(){this.composingInProgress=!0,this.emailContent="",this.attachments=[]},cancelEmail:function(){this.composingInProgress=!1,this.emailContent="",this.attachments=[]}},watch:{details:function(e){e&&this.cancelEmail()}},props:{selectedTab:{type:Number,required:!0},emailTemplates:{type:Object,required:!1},details:{type:Object,required:!0}}},et=Ye,tt=(a("111c"),Object(b["a"])(et,Ke,Qe,!1,null,null,null)),at=tt.exports;A()(tt,{VBtn:K["a"],VCard:Q["a"],VCol:te["a"],VContainer:le["a"],VRow:ae["a"]});var st={name:"MangoFpDetailPane",components:{MangoFpStateSelector:me,MangoFpEmailHistory:Ze,MangoFpEmail:at,MangoFpMessageInList:C},methods:{labelChanged:function(e){kt.$emit("EventMessageLabelChanged",{message:Object(l["a"])(Object(l["a"])({},this.details),{},{labelId:e})})},emailChanged:function(e){kt.$emit("EventEmailLabelChanged",{message:Object(l["a"])(Object(l["a"])({},this.details),{},{email:e})})},nameChanged:function(e){kt.$emit("EventNameLabelChanged",{message:Object(l["a"])(Object(l["a"])({},this.details),{},{name:e})})},noteChanged:function(e){kt.$emit("EventNoteChanged",{message:Object(l["a"])(Object(l["a"])({},this.details),{},{note:e})})},getContactDataSummary:function(){return this.details.email+(this.selectedLabel.text?", "+this.selectedLabel.text:"")},closeDetailsPane:function(){this.$emit("CloseDetails")},getActiveDetailsTab:function(e,t){var a=e.find((function(e){return e.id===t}));return a&&a.isUnread?1:0}},computed:{actions:function(){if(this.selectedTab&&this.statuses[this.selectedTab]&&this.statuses[this.selectedTab].next&&!Array.isArray(this.statuses[this.selectedTab].next))return[];var e={};return Object.values(this.statuses).forEach((function(t){e[t.code]=t.action})),this.statuses[this.selectedTab].next.map((function(t){return{code:t,name:e[t]}}))},details:function(){var e=this,t={email:"",name:"",label:"",labelId:"",note:"",content:[],isUnread:!1};if(!this.selectedItem)return t;var a=this.submitted.find((function(t){return t.id===e.selectedItem}));return a?{name:a.name,email:a.email,label:a.label,labelId:a.labelId,id:a.id,note:a.note,changeHistory:a.changeHistory,content:a.content,isUnread:a.isUnread}:t},rowsForNote:function(){var e=this;if(!this.selectedItem)return 1;var t=30,a=1,s=this.submitted.find((function(t){return t.id===e.selectedItem}));if(!s.note)return a;var n=parseInt(s.note.length/45);return a>n?a:t<n?t:n},selectedLabel:{get:function(){var e=this.details,t=this.labelsData.find((function(t){return t.id===e.labelId}));return t?{value:e.labelId,text:t.name}||"":{value:"",text:""}},set:function(e){this.labelChanged(e)}},labels:function(){return this.labelsData.map((function(e){return{value:e.id,text:e.name}}))},emailTemplates:function(){return this.globalState.emailTemplates}},props:{selectedItem:{type:String,required:!1},labelsData:{type:Array,required:!0},submitted:{type:Array,required:!0},selectedTab:{type:Number,required:!0},statuses:{type:Array,required:!0}},watch:{selectedItem:function(){this.selectedDetail=this.getActiveDetailsTab(this.submitted,this.selectedItem)}},data:function(){return{globalState:It,contentOpen:[0],dataOpen:[],selectedDetail:this.getActiveDetailsTab(this.submitted,this.selectedItem)}},mounted:function(){return Object(d["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Pe();case 1:case"end":return e.stop()}}),e)})))()}},nt=st,it=(a("4e58"),a("71a3")),rt=a("c671"),ot=a("fe57"),lt=a("a844"),ct=Object(b["a"])(nt,I,F,!1,null,null,null),dt=ct.exports;A()(ct,{VBtn:K["a"],VCard:Q["a"],VCol:te["a"],VExpansionPanel:Le["a"],VExpansionPanelContent:He["a"],VExpansionPanelHeader:qe["a"],VExpansionPanels:We["a"],VIcon:W["a"],VRow:ae["a"],VSelect:ce["a"],VSheet:O["a"],VTab:it["a"],VTabItem:rt["a"],VTabs:ot["a"],VTextField:se["a"],VTextarea:lt["a"]});var ut={name:"MangoFpContainer",components:{MangoFpListPane:k,MangoFpDetailPane:dt},mounted:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var a,s,n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.subscribe(),t.prev=1,t.next=4,Promise.all([Ee(),xe(),$e()]);case 4:n=t.sent,i=Object(c["a"])(n,3),e.labelsData=i[0],a=i[1],s=i[2],s&&(Ae(a),e.loaded=!0),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](1),e.error=t.t0.message;case 15:case"end":return t.stop()}}),t,null,[[1,12]])})))()},methods:{openSidePane:function(){this.listWidth=3},closeSidePane:function(){this.listWidth=12,this.selectedItem=""},rowSelected:function(e){this.selectedItem=e.id,e.changeHistory||Ie(e.id,kt),this.openSidePane()},tabChanged:function(e){this.selectedTab=e,this.closeSidePane()},subscribe:function(){var e=this;kt.$on("EventMessageLabelChanged",(function(e){Te({message:{id:e.message.id,labelId:e.message.labelId}},kt)})),kt.$on("GetMessageDetails",(function(e){Ie(e.id,kt)})),kt.$on("EventEmailLabelChanged",(function(e){Te({message:{id:e.message.id,email:e.message.email}},kt)})),kt.$on("EventNameLabelChanged",(function(e){Te({message:{id:e.message.id,name:e.message.name}},kt)})),kt.$on("EventNoteChanged",(function(e){Te({message:{id:e.message.id,note:e.message.note}},kt)})),kt.$on("EventMessageStateChanged",(function(t){var a=Te({message:{id:t.messageId,code:t.newState}},kt);a&&e.closeSidePane()})),kt.$on("EventSendEmail",(function(e){je({message:{id:e.messageId,emailContent:e.emailContent,addresses:e.addresses,ccAddresses:e.ccAddresses,emailSubject:e.emailSubject,emailAttachments:e.emailAttachments}},kt)})),kt.$on("EventSendEmailAndChangeState",(function(t){var a=Te({message:{id:t.messageId,code:t.newState,emailContent:t.emailContent,addresses:t.addresses,ccAddresses:t.ccAddresses,emailSubject:t.emailSubject,emailAttachments:t.emailAttachments}},kt);a&&(e.selectedItem=""),e.closeSidePane()})),kt.$on("ErrorConnection",(function(t){e.error=t.error})),kt.$on("DataMessageUpdated",(function(t){var a=e.messagesData.findIndex((function(e){return e.id===t.id}));a<0?e.messagesData.push(t):e.messagesData.splice(a,1,t)}))},selectAll:function(){var e=this;this.$nextTick((function(){e.labelFilter=[]}))},getTabClasses:function(e){return e.isUnread?"bolder":""}},computed:{statuses:function(){return Object.values(this.allSteps)},appVersion:function(){if(!window.MANGOFP_RESOURCES.version)return"NA";for(var e=[],t=0,a=Object.entries(window.MANGOFP_RESOURCES.version);t<a.length;t++){var s=Object(c["a"])(a[t],2),n=s[0],i=s[1];e.push(n+" - "+i)}return e.join(", ")||"n/a"},submitted:function(){var e={};this.labelsData.forEach((function(t){e[t.id]=t.name}));var t=this.messagesData.map((function(t){return Object(l["a"])(Object(l["a"])({},t),{},{label:e[t.labelId]||"",changeHistory:t.changeHistory||!1})}));return t},filtered:function(){var e=this;return this.submitted.filter((function(t){return t.code===e.statuses[e.selectedTab].code&&(0==e.labelFilter.length||e.labelFilter.includes(t.labelId))}))},labels:function(){var e=this.labelsData.map((function(e){return{value:e.id,text:e.name}}));return e},detailPaneIsOpen:function(){return 12!=this.listWidth},icon:function(){return 0==this.labelFilter.length?"mdi-checkbox-marked":"mdi-checkbox-blank-outline"}},data:function(){return{selectedItem:"",listWidth:"12",loaded:!1,labelFilter:[],selectedTab:1,allSteps:It.steps,stateData:[],labelsData:[],messagesData:It.messagesData}}},mt=ut,ht=(a("6aa3"),a("ce7e")),pt=a("1800"),ft=Object(b["a"])(mt,r,o,!1,null,null,null),vt=ft.exports;A()(ft,{VCol:te["a"],VDivider:ht["a"],VIcon:W["a"],VListItem:Be["a"],VListItemAction:pt["a"],VListItemContent:Je["a"],VListItemTitle:Je["b"],VRow:ae["a"],VSelect:ce["a"],VSheet:O["a"],VTab:it["a"],VTabItem:rt["a"],VTabs:ot["a"]});var bt={name:"App",components:{MangoFpContainer:vt}},gt=bt,Ct=a("7496"),St=Object(b["a"])(gt,n,i,!1,null,null,null),Et=St.exports;A()(St,{VApp:Ct["a"]});var yt=a("ade3"),wt=a("d4ec"),xt=a("bee2"),_t=function(){function e(){Object(wt["a"])(this,e),this.steps={},this.emailTemplates={},this.templateLoaded=!1,this.messagesData=[]}return Object(xt["a"])(e,[{key:"setTemplate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{addresses:[],ccAddresses:[],template:""},a=t.addresses,s=void 0===a?[]:a,n=t.ccAddresses,i=void 0===n?[]:n,r=t.template,o=void 0===r?"":r;this.emailTemplates=Object.assign({},this.emailTemplates,Object(yt["a"])({},e,{addresses:s,ccAddresses:i,template:o}))}},{key:"setTemplatesLoaded",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.templateLoaded=e}},{key:"setStep",value:function(e,t){if(!("code"in t))throw new Error("code not found in stepObj");if(!("action"in t))throw new Error("action not found in stepObj");if(!("order"in t))throw new Error("order not found in stepObj");return this.steps[e]=Object(l["a"])(Object(l["a"])({},t),{},{isUnread:!1}),this}},{key:"getSteps",value:function(){if(!this.steps)throw new Error("Steps not loaded yet");return this.steps}},{key:"resetSteps",value:function(){for(var e in this.steps)delete this.steps[e];return this}},{key:"findMessage",value:function(e){return this.messagesData.find((function(t){return t.id===e}))}},{key:"resetMessages",value:function(){return this.messagesData.splice(0,this.messageData.length),!0}},{key:"addMessage",value:function(e){return this.messagesData.push(e),!0}},{key:"getMessageHistory",value:function(e){var t=this.findMessage(e);return!!t&&t.changeHistory}},{key:"setMessageHistoryItemRead",value:function(e){var t=this.findMessage(e.messageId);if(!t)throw new Error("message not found for history item update");if(!("changeHistory"in t)||!Array.isArray(t["changeHistory"]))throw new Error("Message history not loaded yet - unable to set UnRead");var a=e.historyItemId,s=t.changeHistory.find((function(e){return e.id===a}));if(!s)throw new Error("History item not found for history item update");if(s.isUnread=e.isUnread,e.isUnread)t.isUnread=!0,this.setStepUnread(t.code,!0);else{var n=t.changeHistory.find((function(e){return e.isUnread}));n?(t.isUnread=!0,this.setStepUnread(t.code,!0)):(t.isUnread=!1,this.checkAndSetStepUnreadStatus(t.code))}return!0}},{key:"checkAndSetStepUnreadStatus",value:function(e){if(!(e in this.steps))throw new Error("Could not find step for setting unread");var t=this.messagesData.find((function(t){return t.code===e&&t.isUnread}));return t?this.setStepUnread(e,!0):this.setStepUnread(e,!1),!0}},{key:"setStepUnread",value:function(e,t){if(!(e in this.steps))throw new Error("Could not find step for setting unread");return this.steps[e].isUnread=t,!0}}]),e}(),At=a("f309");s["a"].use(At["a"]);var jt=new At["a"]({}),Ot={install:function(e){e.prototype.$locStr=function(e){return MANGOFP_RESOURCES&&MANGOFP_RESOURCES.strings&&MANGOFP_RESOURCES.strings[e]?MANGOFP_RESOURCES.strings[e]:e}}},Tt=Ot;s["a"].config.productionTip=!1;var kt=new s["a"],It=new _t;s["a"].use(Tt),new s["a"]({vuetify:jt,render:function(e){return e(Et)}}).$mount("#app")},"67ae":function(e,t,a){"use strict";a("15ae")},"6aa3":function(e,t,a){"use strict";a("2d12")},"6b1b":function(e,t,a){"use strict";a("d2ed")},"6ec9":function(e,t,a){"use strict";a("ac1a")},"81b1":function(e,t,a){},ac1a:function(e,t,a){},ae84:function(e,t,a){},b660:function(e,t,a){},d2ed:function(e,t,a){}});
//# sourceMappingURL=app.9609287a.js.map